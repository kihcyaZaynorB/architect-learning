# design-pattern-learning-notes

## Java 原子性

只有常量赋值才是原子性操作。
原子性：`int x = 10;`
非原子性：`y = x;` (读取x，赋值给y，在读取过程中x的值可能会出现变化)

## Java 指令重排序

在不影响结果的情况下，JVM会对程序进行执行优化(执行顺序不是代码顺序)

```java
int i = 10;
boolean flag = false;

i++;
flag = true;
```

在上述代码块中，`i++`与`flag = true`这两句代码的顺序变化不会造成结果的改变。在Jvm对指令重排序后，程序的

执行顺序可能会与代码顺序不相同，在单线程执行中，指令重排序不会造成影响，但在多线程中，会出现线程安全问题。

因此，有些时候需要禁止重排序 (`volatile`)

volatile

+ 可见性的保证

  ```java
  i = 10;  //初始数据
  i++;   //线程1操作  ----- i = 11
  
  y = i; //线程2操作  ----- i = 10, y = 10
  ```

  上述代码块中，由于线程1对变量`i`的修改没有写入主存，因此线程2读取到的`i`值还是10，即线程1的修改对线程2来说是不可见的。

  如何保证可见性？

+ 